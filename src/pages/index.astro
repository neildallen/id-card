---
import "../styles/global.css";
---

<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Eyteen Plus</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="/styles/global.css" />
		<script
			src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"
		></script>
	</head>
	<body>
		<div class="bg-icons">
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
		</div>

		<header class="header">
			<img src="/logo.png" class="logo" alt="18+" />
			<h1>EYTEEN PLUS</h1>
			<p class="ca">CA: XXXXXXXXXXXXXXXXXXXXX</p>
			<nav>
				<a href="#">18+ COMMUNITY</a>
				<a href="#">BUY $18+</a>
			</nav>
		</header>

		<main>
			<form id="eyteenForm" class="id-form">
				<div class="form-row">
					<label>
						Gender:
						<select id="sex">
							<option>Male</option>
							<option>Female</option>
							<option>Other</option>
						</select>
					</label>
					<label>
						Ethnicity:
						<select id="ethnicity">
							<option>White</option>
							<option>Black</option>
							<option>Asian</option>
							<option>Mixed</option>
							<option>Other</option>
						</select>
					</label>
				</div>

				<div class="form-row">
					<label>
						Hair Color:
						<select id="hair">
							<option>Blonde</option>
							<option>Brown</option>
							<option>Black</option>
							<option>Red</option>
							<option>Gray</option>
							<option>Other</option>
						</select>
					</label>
					<label>
						Eye Color:
						<select id="eyes">
							<option>Blue</option>
							<option>Brown</option>
							<option>Green</option>
							<option>Hazel</option>
							<option>Gray</option>
						</select>
					</label>
				</div>

				<div class="form-row">
					<label>
						Character Style:
						<select id="style">
							<option>Cyberpunk</option>
							<option>Fantasy</option>
							<option>Realistic</option>
							<option>Cartoon</option>
							<option>Pixel Art</option>
							<option>Other</option>
						</select>
					</label>
					<label>
						Name:
						<input type="text" id="name" placeholder="e.g. John Doe" />
					</label>
				</div>

				<div class="form-row">
					<label>
						Age (18+ Only):
						<input type="number" id="age" min="18" value="18" />
					</label>
					<label>
						Job:
						<select id="job">
							<option value="Trencher">Trencher</option>
							<option value="KOL">KOL</option>
							<option value="custom">Custom</option>
						</select>
					</label>
				</div>

				<div class="form-row" id="customJobLabel" style="display: none;">
					<label>
						Custom Job:
						<input type="text" id="customJob" placeholder="Enter custom job" />
					</label>
				</div>

				<p class="img-or-upload">Generate an image or upload your own</p>
				<button type="button" id="generateDalle"
					>üé® Generate Image with DALL¬∑E</button
				>
				<label>
					Upload Your Own:
					<input type="file" id="photo" accept="image/*" />
				</label>
				<button type="submit">Generate ID</button>
			</form>

			<section id="idCard" class="id-card" style="display: none;">
				<div id="cardContent">
					<img src="/id-placeholder.jpg" id="previewImg" alt="ID Photo" />
					<div><strong>Name:</strong> <span id="outName"></span></div>
					<div><strong>Sex:</strong> <span id="outSex"></span></div>
					<div><strong>Age:</strong> <span id="outAge"></span></div>
					<div><strong>Hair:</strong> <span id="outHair"></span></div>
					<div><strong>Eyes:</strong> <span id="outEyes"></span></div>
					<div><strong>Ethnicity:</strong> <span id="outEthnicity"></span></div>
					<div><strong>Job:</strong> <span id="outJob"></span></div>
					<div><strong>Address:</strong> <span id="outAddress"></span></div>
					<button id="downloadBtn">‚¨áÔ∏è Download ID as PNG</button>
				</div>
			</section>

			<footer class="footer">
				<p>YOU CAN USE THIS LICENSE FOR MANY THINGS:</p>
				<ul>
					<li>‚úÖ ONLYFANS</li>
					<li>‚úÖ KYC</li>
					<li>‚úÖ STRIP CLUBS</li>
					<li>‚úÖ BUY ALCOHOL</li>
					<li>‚úÖ TALK TO 18+ COMPANIONS</li>
				</ul>
			</footer>

			<script is:inline>
				window.addEventListener("DOMContentLoaded", () => {
					const form = document.getElementById("eyteenForm");
					const previewImg = document.getElementById("previewImg");
					const idCard = document.getElementById("idCard");
					const downloadBtn = document.getElementById("downloadBtn");
					const jobDropdown = document.getElementById("job");
					const customJobField = document.getElementById("customJobLabel");
					const dalleBtn = document.getElementById("generateDalle");

					jobDropdown.addEventListener("change", () => {
						customJobField.style.display =
							jobDropdown.value === "custom" ? "block" : "none";
					});

					function generateRandomAddress() {
						const streets = [
							"Maple Ave",
							"Oak St",
							"Elm Rd",
							"Main Blvd",
							"Sunset Dr",
						];
						const cities = [
							"Franklin",
							"Springfield",
							"Riverside",
							"Fairview",
							"Greenville",
						];
						const states = ["CA", "NY", "TX", "FL", "IL"];
						const zip = Math.floor(10000 + Math.random() * 89999);
						const streetNum = Math.floor(Math.random() * 900) + 100;
						const streetName =
							streets[Math.floor(Math.random() * streets.length)];
						const city = cities[Math.floor(Math.random() * cities.length)];
						const state = states[Math.floor(Math.random() * states.length)];
						return `${streetNum} ${streetName}, ${city}, ${state} ${zip}`;
					}

					form.addEventListener("submit", (e) => {
						e.preventDefault();

						const age = parseInt(document.getElementById("age").value, 10);
						if (isNaN(age) || age < 18) {
							alert("‚ùå You must be 18 or older.");
							return;
						}

						const job =
							jobDropdown.value === "custom"
								? document.getElementById("customJob").value
								: jobDropdown.value;

						document.getElementById("outName").textContent =
							document.getElementById("name").value;
						document.getElementById("outSex").textContent =
							document.getElementById("sex").value;
						document.getElementById("outAge").textContent = age;
						document.getElementById("outHair").textContent =
							document.getElementById("hair").value;
						document.getElementById("outEyes").textContent =
							document.getElementById("eyes").value;
						document.getElementById("outEthnicity").textContent =
							document.getElementById("ethnicity").value;
						document.getElementById("outJob").textContent = job;
						document.getElementById("outAddress").textContent =
							generateRandomAddress();

						form.style.display = "none";
						idCard.style.display = "block";
					});

					document
						.getElementById("photo")
						.addEventListener("change", (event) => {
							const file = event.target.files[0];
							if (file) {
								const reader = new FileReader();
								reader.onload = () => (previewImg.src = reader.result);
								reader.readAsDataURL(file);
							}
						});

					dalleBtn.addEventListener("click", async () => {
						dalleBtn.textContent = "üé® Generating...";
						dalleBtn.disabled = true;

						const name = document.getElementById("name").value || "person";
						const sex = document.getElementById("sex").value || "person";
						const ethnicity = document.getElementById("ethnicity").value || "";
						const hair = document.getElementById("hair").value || "";
						const eyes = document.getElementById("eyes").value || "";
						const style =
							document.getElementById("style").value || "digital painting";
						const job =
							jobDropdown.value === "custom"
								? document.getElementById("customJob").value || "job"
								: jobDropdown.value;

						const prompt = `${style} headshot ID photo of a ${sex.toLowerCase()} ${ethnicity.toLowerCase()} with ${hair.toLowerCase()} hair and ${eyes.toLowerCase()} eyes, profession: ${job.toLowerCase()}, name: ${name}, white background, centered face`;

						try {
							const res = await fetch("/api/generate-image", {
								method: "POST",
								headers: { "Content-Type": "application/json" },
								body: JSON.stringify({ prompt }),
							});
							const data = await res.json();
							if (data.imageUrl) {
								previewImg.src = data.imageUrl;
							} else {
								throw new Error("No image URL returned");
							}
						} catch (err) {
							console.error("Image generation error:", err);
							alert(
								"‚ö†Ô∏è DALL¬∑E image generation failed ‚Äî using placeholder instead.",
							);
							previewImg.src = "/id-placeholder.jpg";
						} finally {
							dalleBtn.textContent = "üé® Generate Image with DALL¬∑E";
							dalleBtn.disabled = false;
						}
					});

					downloadBtn.addEventListener("click", () => {
						html2canvas(idCard).then((canvas) => {
							const link = document.createElement("a");
							link.download = "Eyteen-ID.png";
							link.href = canvas.toDataURL("image/png");
							link.click();
						});
					});
				});
			</script>
		</main>
	</body>
</html>
