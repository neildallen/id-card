---
import "../styles/global.css";
---

<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Eyteen Plus</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="/styles/global.css" />
	</head>
	<body>
		<div class="bg-icons">
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
			<img src="/id-placeholder.jpg" alt="ID" />
		</div>
		<header class="header">
			<img src="/logo.png" class="logo" alt="18+" />
			<h1>EYTEEN PLUS</h1>
			<p class="ca">CA: XXXXXXXXXXXXXXXXXXXXX</p>
			<nav>
				<a href="#">18+ COMMUNITY</a>
				<a href="#">BUY $18+</a>
			</nav>
		</header>

		<main>
			<form id="eyteenForm" class="id-form">
				<div class="form-row">
					<label
						>Gender:
						<select id="sex">
							<option>Male</option>
							<option>Female</option>
							<option>Other</option>
						</select>
					</label>

					<label
						>Ethnicity:
						<select id="ethnicity">
							<option>White</option>
							<option>Black</option>
							<option>Asian</option>
							<option>Mixed</option>
							<option>Other</option>
						</select>
					</label>
				</div>

				<div class="form-row">
					<label
						>Hair Color:
						<select id="hair">
							<option>Blonde</option>
							<option>Brown</option>
							<option>Black</option>
							<option>Red</option>
							<option>Gray</option>
							<option>Other</option>
						</select>
					</label>

					<label
						>Eye Color:
						<select id="eyes">
							<option>Blue</option>
							<option>Brown</option>
							<option>Green</option>
							<option>Hazel</option>
							<option>Gray</option>
						</select>
					</label>
				</div>

				<div class="form-row">
					<label
						>Character Style:
						<select id="style">
							<option>Cyberpunk</option>
							<option>Fantasy</option>
							<option>Realistic</option>
							<option>Cartoon</option>
							<option>Pixel Art</option>
							<option>Other</option>
						</select>
					</label>

					<label
						>Name:
						<input type="text" id="name" placeholder="e.g. John Doe" />
					</label>
				</div>

				<div class="form-row">
					<label>
						Age (18+ Only):
						<input type="number" id="age" min="18" value="18" />
					</label>

					<label>
						Job:
						<select id="job">
							<option value="Trencher">Trencher</option>
							<option value="KOL">KOL</option>
							<option value="custom">Custom</option>
						</select>
					</label>
				</div>

				<label id="customJobLabel" style="display:none;">
					Custom Job:
					<input type="text" id="customJob" placeholder="Enter custom job" />
				</label>

				<p class="img-or-upload">Generate an image or upload your own</p>

				<button type="button" id="generateDalle"
					>üé® Generate Image with DALL¬∑E</button
				>

				<label
					>Upload Your Own:
					<input type="file" id="photo" accept="image/*" />
				</label>

				<button type="submit">Generate ID</button>
			</form>

			<section class="id-card" id="idCard" style="display:none">
				<img src="/id-placeholder.jpg" id="previewImg" />
				<div><strong>Name:</strong> <span id="outName"></span></div>
				<div><strong>Sex:</strong> <span id="outSex"></span></div>
				<div><strong>Age:</strong> <span id="outAge"></span></div>
				<div><strong>Job:</strong> <span id="outJob"></span></div>
			</section>
		</main>

		<footer class="footer">
			<p>YOU CAN USE THIS LICENSE FOR MANY THINGS:</p>
			<ul>
				<li>‚úÖ ONLYFANS</li>
				<li>‚úÖ KYC</li>
				<li>‚úÖ STRIP CLUBS</li>
				<li>‚úÖ BUY ALCOHOL</li>
				<li>‚úÖ TALK TO 18+ COMPANIONS</li>
			</ul>
		</footer>

		<script is:inline>
			window.addEventListener("DOMContentLoaded", () => {
				const form = document.getElementById("eyteenForm");
				const previewImg = document.getElementById("previewImg");
				const jobDropdown = document.getElementById("job");
				const customJobField = document.getElementById("customJobLabel");

				jobDropdown.addEventListener("change", () => {
					customJobField.style.display =
						jobDropdown.value === "custom" ? "block" : "none";
				});

				form.addEventListener("submit", (e) => {
					e.preventDefault();
					const age = parseInt(document.getElementById("age").value, 10);
					if (isNaN(age) || age < 18) {
						alert("‚ùå You must be 18 or older.");
						return;
					}

					const job =
						jobDropdown.value === "custom"
							? document.getElementById("customJob").value
							: jobDropdown.value;

					document.getElementById("idCard").style.display = "block";
					document.getElementById("outName").textContent =
						document.getElementById("name").value;
					document.getElementById("outSex").textContent =
						document.getElementById("sex").value;
					document.getElementById("outAge").textContent = age;
					document.getElementById("outJob").textContent = job;
				});

				document.getElementById("photo").addEventListener("change", (event) => {
					const file = event.target.files[0];
					if (file) {
						const reader = new FileReader();
						reader.onload = () => (previewImg.src = reader.result);
						reader.readAsDataURL(file);
					}
				});

				document
					.getElementById("generateDalle")
					.addEventListener("click", async () => {
						const name = document.getElementById("name").value || "person";
						const job = jobDropdown.value || "character";
						const prompt = `anime cartoon style portrait of a ${job} named ${name}, smiling, ID photo, plain background`;

						previewImg.src = "/id-placeholder.jpg";

						try {
							const res = await fetch("/api/generate-image", {
								method: "POST",
								headers: { "Content-Type": "application/json" },
								body: JSON.stringify({ prompt }),
							});

							const data = await res.json();
							if (data.imageUrl) {
								previewImg.src = data.imageUrl;
							} else {
								throw new Error("No image URL returned");
							}
						} catch (err) {
							console.error("Image generation error:", err);
							alert(
								"‚ö†Ô∏è DALL¬∑E image generation failed ‚Äî using placeholder instead.",
							);
						}
					});
			});
		</script>
	</body>
</html>
